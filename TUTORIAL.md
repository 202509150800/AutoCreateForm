# 詳細使用教程

## 目錄
1. [安裝與啟動](#安裝與啟動)
2. [準備數據](#準備數據)
3. [建立 Word 範本](#建立-word-範本)
4. [執行批量生成](#執行批量生成)
5. [進階用法](#進階用法)
6. [故障排除](#故障排除)

---

## 安裝與啟動

### 必要環境
- **Node.js 14.0 或更高版本**
- **npm 6.0 或更高版本**

### 檢查環境
```bash
node --version    # 應顯示 v14.0.0 或更高
npm --version     # 應顯示 6.0.0 或更高
```

### 安裝步驟

#### 1. 打開終端/命令提示符

**Windows:**
- 按 `Win + R` → 輸入 `cmd` → Enter

**macOS:**
- 按 `Command + Space` → 輸入 `terminal` → Enter

**Linux:**
- 按 `Ctrl + Alt + T`

#### 2. 進入項目目錄
```bash
cd "c:\Users\fung\Desktop\2025\test\AutoCreateForm"
```

#### 3. 安裝依賴
```bash
npm install
```
*首次安裝會花費 2-5 分鐘，請耐心等待*

#### 4. 啟動應用
```bash
npm start
```

#### 5. 打開瀏覽器
訪問: **http://localhost:3000**

---

## 準備數據

### 步驟 1: 下載 Excel 範本

1. 打開應用 (http://localhost:3000)
2. 點擊「📥 下載 Excel 範本」按鈕
3. 將檔案保存到電腦

### 步驟 2: 填寫 Excel 資料

用 Microsoft Excel 或 Google Sheets 打開範本檔案

#### 必需欄位
- **ID** (必須) - 唯一識別碼，用作生成檔案的名稱

#### 範例數據

```
| ID | 姓名 | 電話 | 地址 | 備註 |
|----|------|------|------|------|
| 1 | 張三 | 0912345678 | 台北市信義區 | 正式檔案 |
| 2 | 李四 | 0987654321 | 台中市西屯區 | 待確認 |
| 3 | 王五 | 0968473829 | 高雄市左營區 | 已核准 |
| ... | ... | ... | ... | ... |
```

#### 注意事項
- **ID 必須唯一** - 不能重複
- **ID 必須是數字** - 推薦使用 1, 2, 3...
- **其他欄位可為空** - 但建議填寫
- **避免特殊字符** - 在 ID 中避免 / \ : * ? " < > |
- **使用簡體或繁體中文** - 避免其他語言

### 保存檔案
1. 點擊 File → Save As
2. 選擇檔案類型: **Excel Workbook (.xlsx)**
3. 命名為: `data.xlsx`
4. 點擊 Save

---

## 建立 Word 範本

### 步驟 1: 新建 Word 文檔

1. 打開 Microsoft Word
2. 選擇「空白文檔」
3. 根據需要設計您的表格/文檔

### 步驟 2: 插入佔位符

在 Word 中想要填寫資料的位置插入 **佔位符**

#### 佔位符格式
```
{{欄位名稱}}
```

#### 範例 1: 簡單文本替換

```
=== 個人資訊表 ===

姓名：{{姓名}}
電話：{{電話}}
地址：{{地址}}

備註：{{備註}}
```

#### 範例 2: 表格佈局

```
┌──────────────────┐
│ 個人資訊表       │
├──────────────────┤
│ 姓名: {{姓名}}   │
│ 電話: {{電話}}   │
│ 地址: {{地址}}   │
└──────────────────┘
```

#### 範例 3: 發票範本

```
發票編號：{{發票號}}
客戶：{{客戶名稱}}
日期：{{日期}}
金額：{{金額}}
稅額：{{稅額}}
合計：{{合計}}
```

### 步驟 3: 設定樣式（可選）

- 調整字體、顏色、大小
- 添加公司標誌/圖片
- 設置頁面邊距和方向
- 添加頁眉/頁腳

### 步驟 4: 保存範本

1. File → Save As
2. 選擇檔案類型: **Word Document (.docx)**
3. 命名為: `template.docx`
4. 點擊 Save

#### 重要提示
- **必須是 .docx 格式** - 不支持 .doc
- **佔位符區分大小寫** - {{姓名}} ≠ {{SHENGMING}}
- **佔位符名稱必須與 Excel 欄位完全相同**

---

## 執行批量生成

### 步驟 1: 打開應用

在瀏覽器中訪問: **http://localhost:3000**

### 步驟 2: 上傳 Excel

1. 在「Step 2 - 上傳 Excel 資料」區域
2. 點擊上傳框或拖拽 `data.xlsx` 到框中
3. 確認檔案名稱顯示

### 步驟 3: 上傳 Word 範本

1. 在「Step 3 - 上傳 Word 範本」區域
2. 點擊上傳框或拖拽 `template.docx` 到框中
3. 確認檔案名稱顯示

### 步驟 4: 設置生成選項

在「Step 4 - 設置與生成」區域:

- ☑ **生成 Word 檔案** - 勾選來生成 .docx
- ☑ **生成 PDF 檔案** - 勾選來生成 .pdf

*如果只需要 Word 或只需要 PDF，可取消不需要的選項*

### 步驟 5: 開始生成

1. 點擊「🚀 開始生成」按鈕
2. 等待進度條完成 (100%)
3. 查看結果摘要

### 步驟 6: 下載結果

1. 點擊「📦 下載全部檔案 (ZIP)」
2. 瀏覽器會下載 `generated_files.zip`
3. 解壓縮 ZIP 檔案
4. 所有生成的檔案將在解壓縮後的資料夾中

#### 生成結果示例

如果 Excel 中有 3 筆記錄（ID: 1, 2, 3）

```
generated_files.zip
├── 1.docx     ← ID=1 的 Word 檔案
├── 1.pdf      ← ID=1 的 PDF 檔案
├── 2.docx     ← ID=2 的 Word 檔案
├── 2.pdf      ← ID=2 的 PDF 檔案
├── 3.docx     ← ID=3 的 Word 檔案
└── 3.pdf      ← ID=3 的 PDF 檔案
```

---

## 進階用法

### 自訂埠號

如果埠 3000 被占用，修改埠號：

1. 打開 `server/app.js`
2. 找到第 11 行: `const PORT = process.env.PORT || 3000;`
3. 改為: `const PORT = process.env.PORT || 8080;` (或其他空閒埠號)
4. 重啟應用: 按 `Ctrl + C` 然後 `npm start`
5. 訪問: `http://localhost:8080`

### 增加檔案大小限制

預設限制為 50MB，如需修改：

1. 打開 `server/app.js`
2. 找到 multer 配置（約第 31-34 行）
3. 修改 `fileSize` 值

```javascript
limits: { fileSize: 100 * 1024 * 1024 }  // 改為 100MB
```

### 使用開發模式

開發模式會在檔案改變時自動重啟應用：

```bash
npm run dev
```

### 檢查日誌

應用會在終端中輸出日誌信息：
```
✓ 伺服器運行在 http://localhost:3000
✓ 打開瀏覽器訪問: http://localhost:3000
```

---

## 故障排除

### 問題 1: 無法連接到 localhost:3000

**症狀:** 訪問 http://localhost:3000 顯示「無法連接」

**解決方案:**
1. 檢查應用是否在運行 (終端中看到上方的成功信息)
2. 嘗試刷新瀏覽器 (Ctrl + F5)
3. 檢查埠 3000 是否被占用
4. 關閉應用 (Ctrl + C)，等待 5 秒，重新運行 `npm start`

### 問題 2: 佔位符未被替換

**症狀:** 生成的 Word 檔案中 {{姓名}} 等沒有被替換成實際值

**檢查清單:**
- ✓ Excel 欄位名稱是否與 Word 佔位符完全相同？
- ✓ 佔位符是否使用 `{{}}` 格式？
- ✓ Excel 欄位名稱和佔位符是否區分大小寫？
- ✓ Excel 中是否有該欄位的數據？

**修復:**
1. 檢查 Word 中的佔位符拼寫
2. 檢查 Excel 中的欄位名稱
3. 確保完全相同（包括大小寫）
4. 重新上傳並生成

### 問題 3: PDF 轉換失敗

**症狀:** 只生成了 Word 檔案，沒有 PDF

**原因:** 系統缺少 LibreOffice

**Windows 解決方案:**

**方式 1: 使用 Chocolatey (推薦)**
```powershell
# 以管理員身份打開 PowerShell，執行：
choco install libreoffice
```

**方式 2: 手動下載安裝**
1. 訪問 https://www.libreoffice.org/download/download/
2. 下載 Windows 版本
3. 執行安裝程序

**macOS 解決方案:**
```bash
brew install libreoffice
```

**Linux 解決方案 (Ubuntu/Debian):**
```bash
sudo apt-get install libreoffice
```

### 問題 4: Excel 檔案無法讀取

**症狀:** 上傳 Excel 後收到錯誤信息

**檢查清單:**
- ✓ Excel 格式是否為 .xlsx 或 .xls？
- ✓ Excel 是否包含「ID」欄位？
- ✓ Excel 是否有資料（不只是表頭）？
- ✓ ID 欄位是否有值？

**修復:**
1. 用 Excel 重新打開和保存檔案
2. 確保檔案格式為 .xlsx
3. 添加「ID」欄位（如果缺少）
4. 填寫至少一行資料
5. 重新上傳

### 問題 5: 上傳檔案時頁面無反應

**症狀:** 點擊上傳後沒有反應

**解決方案:**
1. 檢查檔案大小是否超過 50MB
2. 檢查網路連接
3. 嘗試刷新頁面 (Ctrl + F5)
4. 嘗試使用其他瀏覽器
5. 檢查瀏覽器控制台 (F12) 是否有錯誤信息

### 問題 6: 生成進度卡住

**症狀:** 進度條停止在某個百分比

**解決方案:**
1. 等待至少 2-3 分鐘（大檔案需要時間）
2. 檢查 Excel 中是否有問題行（空值、特殊字符）
3. 打開瀏覽器控制台 (F12) 查看錯誤
4. 停止操作 (關閉瀏覽器)，重新開始

### 問題 7: Word 範本格式丟失

**症狀:** 生成的檔案格式與範本不同

**原因:** Word 範本中使用了不支持的高級功能

**解決方案:**
1. 簡化 Word 範本（避免複雜的格式）
2. 不要在佔位符內使用特殊格式
3. 確保使用標準 .docx 格式
4. 避免使用 VBA 巨集

---

## 性能優化建議

### 大量檔案生成
- 建議 Excel 資料不超過 500 筆
- 如果經常超過此數量，考慮分批生成

### 網路優化
- 使用有線網路以提高穩定性
- 避免同時執行其他網路任務

### 系統優化
- 確保硬盤有足夠空間（至少 1GB 可用）
- 定期清理 `uploads/` 和 `output/` 目錄
- 保持 LibreOffice 版本最新

---

## 常見操作

### 重新開始
- 點擊「🔄 重新開始」按鈕
- 將返回第 1 步

### 停止應用
終端中按 `Ctrl + C`

### 查看生成的檔案
1. 下載 ZIP 後解壓縮
2. 或在應用所在目錄找 `output/` 資料夾

---

## 支持

遇到其他問題？

1. 查看瀏覽器控制台 (F12 → Console)
2. 查看終端輸出是否有錯誤信息
3. 參考本教程的「故障排除」部分
4. 嘗試重新啟動應用

---

**祝您使用愉快！** 🎉
